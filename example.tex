%\PassOptionsToClass{handout}{beamer}
\documentclass[aspectratio=169,usepdftitle=true]{beamer}
\usefonttheme{professionalfonts}

\usepackage[T1]{fontenc}
\usepackage[utf8]{luainputenc}
%\usepackage[utf8]{inputenc}
\usepackage{microtype}
\usepackage{unicode-math}
\setmathfont{latinmodern-math.otf}
\usepackage{csquotes}
\usepackage[ngerman]{babel}
\usepackage{lipsum}
\usepackage{listings}
\usepackage[backend=biber,style=alphabetic]{biblatex}
\addbibresource{example.bib}

\usetheme{dividing-lines}
\SetColorProfile{159, 166, 2}{249, 224, 176}{137, 164, 75}

\title{Neuronale Netze}
\subtitle{Handschriftliche Zahlen erkennen}
\institute{Carl-Friedrich-Gauß-Gymnasium}
\license{\ccbysa}

\date{\today}

\author{Jasper Gude}
%\email{j.gude@posteo.de}
\outro{Hockenheim, \today}
\license[]{\url{https://creativecommons.org/licenses/by-sa/4.0/}\quad\ccbysa}

% just an example command
\newcommand\twosplit[3][c]{%
\begin{columns}[#1]
\begin{column}{0.475\linewidth}#2\end{column}\hfill
\begin{column}{0.475\linewidth}#3\end{column}
\end{columns}}

\input{figures.tex}

\def\typesetBox#1#2#3#4{%
    \pbox{7cm}{{\Large\sbfamily#1}\rlap{\textsuperscript{\color{gray}\cite{#4}}}\\\color{gray}#2\hfill#3}%
}

\definecolor{btdl@color@red}{RGB}{163, 75, 102}
\colorlet{semigray}{gray!70!darkgray}
\lstset{
    backgroundcolor=\color{btdl@color@black},
    commentstyle=\color{semigray},
    keywordstyle=\bfseries\color{btdl@color@primary},
    numberstyle=\tiny\color{semigray},
    stringstyle=\color{btdl@color@secondary},
    basicstyle=\ttfamily\color{btdl@color@white},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\usetikzlibrary{arrows.meta,calc,backgrounds,shapes.multipart,intersections,positioning,decorations.pathreplacing}
\tikzset{
    bc/.style={circle,draw,fill,#1,text=darkgray,align=center,text width=0.75em},
    brs/.style={rectangle,rounded corners=2.5pt,draw,fill,#1,text=darkgray,align=center},
    br/.style={brs=#1,rectangle split,rectangle split parts=2,draw=btdl@color@background,thick,font=\scriptsize\sffamily},
    br/.default={hl-shade},
    bcsmall/.style={circle,draw,fill,#1,text=darkgray,align=center,inner sep=2pt},
    bc/.default={hl-shade},
    bcsmall/.default={hl-shade},
    t/.style={ultra thick,#1},
    tarrow/.style={-Kite,t=#1},
    dtarrow/.style={Kite-Kite,t=#1},
    ctarrow/.style={Circle-Kite,t=#1}
}


\def\cfl#1{\faFile\llap{\color{#1}\tiny\faCogs\;}}
\def\tagS#1#2{\node[above left=-0.082cm,darkgray,scale=0.65,circle,fill=lgray,inner sep=1pt] at(#1.south east) {\sbfamily#2};}
\def\tagN#1#2{\node[below left=-0.082cm,darkgray,scale=0.65,circle,fill=hl-shade,inner sep=1pt] at(#1.north east) {\sbfamily#2};}

\colorlet{lgray}{lightgray!45!white}
\colorlet{hl-shade}{btdl@color@secondary}

\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\begin{document}
\section{Modellierung}
\begin{frame}{Modellierung des Problems}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.3\linewidth}
\centering
\mnistAnimated{Mnist3-a.png}
\end{column}\hfill
\begin{column}{0.3\linewidth}
\centering
\mnistAnimated{Mnist3-b.png}
\end{column}\hfill
\begin{column}{0.3\linewidth}
\centering
\mnistAnimated{Mnist3-c.png}
\end{column}
\end{columns}
\centering
\onslide<3->{
\begin{tikzpicture}[bc/.default={lgray}]
\node[rectangle,draw=lgray, fill=white, text=black, align=center, minimum size=1.5cm ] (w) at (0,0) {0,00};
\node[rectangle, fill=white!75!black, text=black, align=center, minimum size=1.5cm,  right=1cm of w] (lg) {0,25};
\node[rectangle, fill=white!50!black, text=white, align=center, minimum size=1.5cm,  right=1cm of lg] (g) {0,50};
\node[rectangle, fill=white!25!black, text=white, align=center, minimum size=1.5cm,  right=1cm of g] (dg) {0,75};
\node[rectangle, fill=black, text=white, align=center, minimum size=1.5cm, right=1cm of dg ] {1,00};
\end{tikzpicture}
}
\end{layout-imageonly}
\end{frame}

\begin{frame}{Überführung auf eine Netzstruktur}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.3\linewidth}
\centering
\mnist{Mnist3-a.png}
28px $\times$ 28px
\end{column}\hfill
\begin{column}{0.7\linewidth}
\centering
\resizebox{!}{0.5\textheight}{
\neuralnetworkAnimated
}
\end{column}
\end{columns}
\end{layout-imageonly}
\end{frame}

\section{Künstliche Neuronen}
\begin{frame}{Gewichtungen setzen}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.5\linewidth}
\twosplit{
\centering
\resizebox{\linewidth}{!}{
\begin{tikzpicture}
\draw[lightgray,thin] (0,0) rectangle (56px,56px);
\fill[black] (16px, 40px) rectangle (36px, 44px);
\draw[step=2px,lightgray,ultra thin] (0,0) grid (56px,56px);
\end{tikzpicture}}
Inputs
}{
\centering
\resizebox{\linewidth}{!}{
\begin{tikzpicture}
\draw[lightgray,thin] (0,0) rectangle (56px,56px);
\onslide<2->{\fill[btdl@color@alerted] (16px, 40px) rectangle (36px, 44px);}
\onslide<3->{\fill[btdl@color@red] (16px, 38px) rectangle (36px, 40px);}
\onslide<3->{\fill[btdl@color@red] (16px, 44px) rectangle (36px, 46px);}
\draw[step=2px,lightgray,ultra thin] (0,0) grid (56px,56px);
\end{tikzpicture}}
Gewichte
}
\begin{block}{Linearkombination}
    \[w_{0}x_{0} + w_{1}x_{1} + \cdots + w_{n}x_{n}\onslide<4->{-b}\]
\end{block}
\end{column}
\begin{column}{0.5\linewidth}
\centering
\resizebox{!}{0.8\textheight}{
\neuralnetworkSingleNeuron
}
\end{column}
\end{columns}

\end{layout-imageonly}
\end{frame}

\begin{frame}{Zahlenbereich begrenzen}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.5\linewidth}
\begin{block}{Sigmoidfunktion}
\[\sigma(x)=\frac{1}{1+e^{-x}}\]
\centering
\resizebox{0.5\linewidth}{!}{
\begin{tikzpicture}
    \begin{axis}[
        axis lines=center,
        xtick={-1,1},
        ytick={0,0.5,...,1},
        xlabel={$x$},
        ylabel={$y$},
        xlabel style={below right},
        ylabel style={above left},
        xmin=-5.5,
        xmax=5.5,
        ymin=-0.5,
        ymax=1.5]
    \addplot[color=btdl@color@alerted, style = {thick}]{1/(1+exp(-x))};
    \end{axis}
\end{tikzpicture}
}
\end{block}
\end{column}
\begin{column}{0.5\linewidth}
\centering
\resizebox{!}{0.8\textheight}{
\neuralnetworkSingleNeuron
}
\end{column}
\end{columns}
\end{layout-imageonly}
\end{frame}

\begin{frame}{Alles zusammen setzen}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.7\linewidth}
\begin{block}{Aktivierungsfunktion}
\only<1-2>{\[a_{0}^{(1)}=\sigma(w_{0,0}a_{0}^{(0)} + w_{0,1}a_{1}^{(0)} + \cdots + w_{0,n}a_{n}^{(0)} -b_{0})\]}
\only<3>{\[\vec{a^{(1)}}=\sigma(W\vec{a^{(0)}}+\vec{b})\]}
\onslide<2->{
\[
\begin{bmatrix}
    a_{0}^{(1)}\\
    a_{1}^{(1)}\\
    \vdots \\
    a_{k}^{(1)}
\end{bmatrix}=
\sigma
    \begin{pmatrix}
        \begin{bmatrix}
        w_{0,0} & w_{0,1} & \cdots & w_{0,n}\\
        w_{1,0} & w_{1,1} & \cdots & w_{1,n}\\
        \vdots & \vdots & \ddots & \vdots \\
        w_{k,0} & w_{k,1} & \cdots & w_{k,n}
        \end{bmatrix}
        \begin{bmatrix}
        a_{0}^{(0)}\\
        a_{1}^{(0)}\\
        \vdots \\
        a_{n}^{(0)}
        \end{bmatrix}
        +
        \begin{bmatrix}
        b_{0}\\
        b_{1}\\
        \vdots \\
        b_{k}
        \end{bmatrix}
    \end{pmatrix}
\]
}
\end{block}
\end{column}
\begin{column}{0.3\linewidth}
\centering
\resizebox{!}{0.8\textheight}{
\neuralnetworkMatrix
}
\end{column}
\end{columns}
\end{layout-imageonly}
\end{frame}
\section{Training}
\begin{frame}{Fehler bestimmen}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.3\linewidth}
\centering
\only<1-2>{
\mnist{Mnist3-a.png}
28px $\times$ 28px
}
\only<3>{
\resizebox{\linewidth}{!}{
\includegraphics[]{MnistExamples}}
Dataset $D$
}

\end{column}\hfill
\begin{column}{0.7\linewidth}
\centering
\only<1>{
\resizebox{!}{0.5\textheight}{
\neuralnetwork
}
}
\only<2>{
\resizebox{!}{0.8\textheight}{
\neuralnetworkCost
}
}
\only<3>{
\begin{block}{Fehlerfunktion: Mean Squared Error}
\centering
$m:$ Anzahl der Einträge in $D$\\
$d:$ Eintrag (Pixelvektor) in $D$

\[ C_{D}(\vec{W})=\frac{1}{m}\sum_{d \in D}(\sum_{i=0}^{9}(a_{i}^{(3,d)}-s_{i}^{(d)})^2)\]
\end{block}


}
\end{column}
\end{columns}
\end{layout-imageonly}
\end{frame}

\begin{frame}{Fehler minimieren}
\begin{layout-imageonly}
\begin{columns}[c]
\begin{column}{0.5\linewidth}
\centering
\only<1>{
Globales Minimum durch Ableiten
}
\only<2>{
Zwei lokale Minima; globales Minimum durch Vergleich
}
\only<3>{
Finden lokaler Minima durch Ableiten nicht möglich
}
\only<4>{
\begin{block}{Gradient Descent}
\centering
$\nabla C(\vec{W}):$ Gradient der Fehlerfunktion $C$ an Stelle $\vec{W}$\\
{\footnotesize\textit{Vektor in Richtung des größten Anstiegs}}\\
\[\vec{W_{neu}}=\vec{W}-\nabla C(\vec{W})\]
\end{block}

}
\end{column}\hfill
\begin{column}{0.5\linewidth}
\centering
\resizebox{0.8\linewidth}{!}{
\only<1>{
\begin{tikzpicture}
\begin{axis}
[
    xlabel={$w$},
    xmin=-1,
    xmax=3,
    xtick={},
    xticklabels={,,},
    ylabel={$C(w)$},
    ymin=0,
    ymax=10,
    ytick={},
    yticklabels={,,},
    domain=-1:3,
    restrict y to domain=0:10,
    axis lines=center,
]
\addplot[draw=none, mark=*, samples at = {1}] {2*(x-1)^2+1};
\addplot[color=btdl@color@alerted, style = {thick}, samples=100, smooth] {2*(x-1)^2+1};
\end{axis}
\end{tikzpicture}
}
\only<2>{
\begin{tikzpicture}
\begin{axis}
[
    xlabel={$w$},
    xmin=-1,
    xmax=3,
    xtick={},
    xticklabels={,,},
    ylabel={$C(w)$},
    ymin=0,
    ymax=10,
    ytick={},
    yticklabels={,,},
    domain=-1:3,
    restrict y to domain=0:10,
    axis lines=center,
]
\addplot[draw=none, mark=*, samples at = {-0.432,2.141}] {x^4-3*x^3+2*x+5};
\addplot[color=btdl@color@alerted, style = {thick}, samples=100, smooth] {x^4-3*x^3+2*x+5};
\end{axis}
\end{tikzpicture}
}
\only<3>{
\begin{tikzpicture}
\begin{axis}
[
    view={45}{45},
    xlabel={$w_0$},
    restrict x to domain=-5:5,
    xmin=-5,
    xmax=5,
    xtick={-5,0,5},
    xticklabels={,,},
    ylabel={$w_1$},
    restrict y to domain=-5:5,
    ymin=-5,
    ymax=5,
    ytick={-5,0,5},
    yticklabels={,,},
    zlabel={$C(w_{0},w_{1})$},
    %z post scale = 2,
    restrict z to domain=-5:10,
    zmin=0,
    zmax=5,
    ytick={0,5},
    zticklabels={,,},
%     axis lines=center,
]
\addplot3[surf,samples=50] {-0.5*sin(deg(y))+0.002*x^4+0.002*y^4-0.2*x+1};
\end{axis}
\end{tikzpicture}
}
}
\only<4>{
\resizebox{0.8\linewidth}{!}{
\begin{tikzpicture}
\begin{axis}
[
    view={0}{90},
    xlabel={$w_0$},
    restrict x to domain=-5:5,
    xmin=-5,
    xmax=5,
    xtick={-5,0,5},
    xticklabels={,,},
    ylabel={$w_1$},
    restrict y to domain=-5:5;
    ymin=-5,
    ymax=5,
    ytick={-5,0,5},
    yticklabels={,,},
    zlabel={$C(w_{0},w_{1})$},
    %z post scale = 2,
    restrict z to domain=-5:10,
    zmin=0,
    zmax=5,
    ytick={0,5},
    zticklabels={,,},
%     axis lines=center,
]
\addplot3[surf,samples=50] {-0.5*sin(deg(y))+0.002*x^4+0.002*y^4-0.2*x+1};
\addplot3[|->, draw=darkgray] coordinates {(0,0,1)  (-0.2,-0.5,1)} node[text=black,midway,left] {$\nabla C$};
\addplot3[|->, draw=lgray] coordinates {(0,0,1)  (0.2,0.5,0.72)} node[text=white,midway,right] {$-\nabla C$};
\addplot3[mark=x,draw=lgray] coordinates {(0.2,0.5,0.72)  (0.6,1.23,0.52)  (0.8,1.4,0.41)  (1,1.45,0.36)  (1.2,1.49,0.32)  (1.4,1.5,0.28)  (1.55,1.51,0.24)  (1.7,1.513,0.21)  (1.9,1.514,0.18)  (2,1.515,0.16)  (2.2,1.515,0.14)  (2.3,1.515,0.12) (2.4,1.515,0.11) (2.5,1.515,0.1)  (2.56,1.515,0.09)};
\end{axis}
\end{tikzpicture}
}
}

\end{column}
\end{columns}
\end{layout-imageonly}
\end{frame}



% \begin{frame}{Aufbau eines Perzeptrons}
%     \begin{layout-imageonly}
%     \centering
%     \perceptron
%     \end{layout-imageonly}
% \end{frame}
%
% \begin{frame}{Übertragungsfunktion}
% \begin{layout-full}
% \twosplit{
% \begin{block}{Linearkombination}
%     \[net = x_0w_{0} + x_1w_{1} + x_2w_{2} + ... + x_nw_{n}\]
%     \centering oder
%     \[net = \sum_{i=0}^{n} {x_iw_{i}} \]
% \end{block}
% }{
% \centering
% \resizebox{\linewidth}{!}{
% \perceptronFirstHalf
% }
% }
% \end{layout-full}
% \end{frame}
%
%
%
%
% \begin{frame}{Fehlerfunktion}
% \begin{layout-full}
% \begin{block}{Dataset}
% \[
%   X = \Bigl\{(\vec{x_0}, y_0);(\vec{x_1}, y_1);(\vec{x_2}, y_2);(\dots, \dots);(\vec{x_n}, y_n)\Bigl\}
% \]
% \end{block}
% \twosplit{
% \begin{block}{Mean Squared Error}
% \[E=\frac{1}{2}\sum_{i=0}^{n}(y_i-o_i)^2\]
% \end{block}
% }{
% \centering
% \resizebox{\linewidth}{!}{
% \perceptron
% }
% }
% \end{layout-full}
% \end{frame}
%
% \section{Training}
% \begin{frame}{Dataset}
%
% \[
%   X = \Bigl\{(\vec{x_0}, y_0);(\vec{x_1}, y_1);(\vec{x_2}, y_2);(\dots, \dots);(\vec{x_n}, y_n)\Bigl\}
% \]
% \end{frame}
%
% \begin{frame}{Ableitung der Aktivierungsfunktion}
% \begin{layout-full}
% \begin{block}{Ableitung der Sigmoidfunktion}
% \twosplit{
% \[\varphi'(x)=\frac{1}{1+e^{-x}}\cdot(1+\frac{1}{1+e^{-x}})\]
% \centering oder
% \[\varphi'(x)=\varphi(x)\cdot(1+\varphi(x))\]
% }{
% \begin{tikzpicture}
% \begin{axis}[
%   axis lines=center,
%   xtick={-1,1},
%   ytick={0,0.25},
%   xlabel={$x$},
%   ylabel={$y$},
%   xlabel style={below right},
%   ylabel style={above left},
%   xmin=-5.5,
%   xmax=5.5,
%   ymin=-0.25,
%   ymax=0.5]
% \addplot[color=btdl@color@alerted, style = {thick}]{
% 1/(1+exp(-x))*(1-1/(1+exp(-x)))};
% \end{axis}
% \end{tikzpicture}
% }
% \end{block}
% \end{layout-full}
% \end{frame}
%
%
% \section{Topologie}
% \begin{frame}{Einschichtiges feedforward-Netz}
%     \begin{layout-imageonly}
%     \centering
%     \feedforwardNetwork
%     \end{layout-imageonly}
% \end{frame}
%
% \begin{frame}{Mehrschichtiges feedforward-Netz}
%     \begin{layout-imageonly}
%     \centering
%     \deepfeedforwardNetwork
%     \end{layout-imageonly}
% \end{frame}
%
% \begin{frame}{Rekurrentes Netz}
%     \begin{layout-imageonly}
%     \centering
%     \recursiveNetwork
%     \end{layout-imageonly}
% \end{frame}


\end{document}
